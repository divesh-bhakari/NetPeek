<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NetPeek | Results Dashboard</title>

<!-- Bootstrap & Fonts -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
:root {
  --primary-color: #0078d7;
  --secondary-color: #00bfa5;
  --gradient: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
  --dark-text: #1a1a1a;
  --muted-text: #555;
  --bg-light: #f7f9fb;
}

/* Base Styles */
body {
  font-family: 'Inter', sans-serif;
  background-color: var(--bg-light);
  color: var(--dark-text);
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

/* Navbar */
.navbar {
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  padding: 1rem 3rem;
}
.navbar-brand {
  font-weight: 700;
  color: var(--primary-color) !important;
  font-size: 1.4rem;
  letter-spacing: 0.5px;
}
.navbar .tagline {
  font-size: 0.95rem;
  color: #6b7280;
  font-weight: 500;
  user-select: none;
}

/* Header */
.page-header {
  text-align: center;
  padding: 3.5rem 1rem 1rem;
}
.page-header h1 {
  font-weight: 700;
  color: var(--dark-text);
  font-size: 2.4rem;
}
.gradient-bar {
  height: 5px;
  width: 160px;
  background: var(--gradient);
  border-radius: 3px;
  margin: 1rem auto 2rem;
}

/* Chart Cards */
.chart-card {
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
  padding: 2rem 2.5rem;
  margin-bottom: 2.5rem;
  transition: transform 0.35s ease, box-shadow 0.35s ease;
  position: relative;
}
.chart-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}

.chart-header {
  background: var(--gradient);
  color: #fff;
  font-weight: 600;
  font-size: 1.15rem;
  padding: 0.75rem 1rem;
  text-align: center;
  border-radius: 10px;
  margin-bottom: 1.25rem;
  letter-spacing: 0.05em;
}

/* Chart Containers */
.chart-container {
  position: relative;
  height: 340px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.center-chart {
  display: flex;
  justify-content: center;
}

/* Footer */
footer {
  text-align: center;
  font-size: 0.9rem;
  color: #666;
  border-top: 1px solid #ddd;
  padding: 1.2rem;
  background: #fff;
  margin-top: 3rem;
}

/* Responsiveness */
@media (max-width: 991px) {
  .chart-container { height: 280px; }
  .page-header h1 { font-size: 2rem; }
}
@media (max-width: 767px) {
  .navbar { padding: 1rem 2rem; }
  .chart-container { height: 240px; }
}
</style>
</head>
<body>

<nav class="navbar">
  <div class="d-flex w-100 justify-content-between align-items-center">
    <div class="navbar-brand">NetPeek Packet Analyzer</div>
    <span class="tagline">Network Analysis Simplified</span>
  </div>
</nav>

<div class="page-header">
  <h1>Analysis Dashboard</h1>
  <div class="gradient-bar"></div>
</div>

<div class="container">

  <!-- PIE CHARTS SIDE BY SIDE -->
  <div class="row">
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Protocol Distribution</div>
        <div class="chart-container"><canvas id="protocolChart"></canvas></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Top Ports Distribution</div>
        <div class="chart-container"><canvas id="extraPieChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- BAR CHARTS -->
  <div class="row">
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Top Source IPs</div>
        <div class="chart-container"><canvas id="topSrcChart"></canvas></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Top Destination IPs</div>
        <div class="chart-container"><canvas id="topDstChart"></canvas></div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Top Ports</div>
        <div class="chart-container"><canvas id="topPortsChart"></canvas></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Top IP Pairs</div>
        <div class="chart-container"><canvas id="topPairsChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- CENTERED LINE CHART -->
  <div class="center-chart">
    <div class="chart-card" style="max-width: 900px; width: 100%;">
      <div class="chart-header">Packet Length Trend</div>
      <div class="chart-container"><canvas id="packetSizeLine"></canvas></div>
    </div>
  </div>

  <!-- RADAR & SCATTER SIDE BY SIDE -->
  <div class="row">
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Protocol Radar</div>
        <div class="chart-container"><canvas id="protocolRadar"></canvas></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="chart-card">
        <div class="chart-header">Packet Size vs Packet #</div>
        <div class="chart-container"><canvas id="timeScatter"></canvas></div>
      </div>
    </div>
  </div>

</div>

<footer>
  Â© 2025 NetPeek | Designed for precision network analysis
</footer>

<!-- JavaScript (Unchanged Functionality) -->
<script>
async function fetchResults() {
  const urlParams = new URLSearchParams(window.location.search);
  const file_id = urlParams.get('file_id');
  const response = await fetch(`/results?file_id=${file_id}`);
  const data = await response.json();

  const pieColors = ['#0078d7','#00bfa5','#f97316','#9333ea','#facc15','#ec4899','#475569'];

  new Chart(document.getElementById('protocolChart'), {
    type:'pie',
    data:{
      labels: data.protocols.map(p=>p.protocol),
      datasets:[{ data: data.protocols.map(p=>p.count), backgroundColor: pieColors }]
    },
    options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
  });

  new Chart(document.getElementById('extraPieChart'), {
    type:'pie',
    data:{
      labels: data.top_ports.map(p=>p.port),
      datasets:[{ data: data.top_ports.map(p=>p.count), backgroundColor: pieColors }]
    },
    options:{ responsive:true, plugins:{ legend:{ position:'bottom' } } }
  });

  new Chart(document.getElementById('topSrcChart'), {
    type:'bar',
    data:{
      labels: data.top_src_ips.map(ip=>ip.src_ip),
      datasets:[{ data: data.top_src_ips.map(ip=>ip.count), backgroundColor: '#0078d7' }]
    },
    options:{ plugins:{ legend:{display:false} }, scales:{ y:{beginAtZero:true} } }
  });

  new Chart(document.getElementById('topDstChart'), {
    type:'bar',
    data:{
      labels: data.top_dst_ips.map(ip=>ip.dst_ip),
      datasets:[{ data: data.top_dst_ips.map(ip=>ip.count), backgroundColor: '#00bfa5' }]
    },
    options:{ plugins:{ legend:{display:false} }, scales:{ y:{beginAtZero:true} } }
  });

  new Chart(document.getElementById('topPortsChart'), {
    type:'bar',
    data:{
      labels: data.top_ports.map(p=>p.port),
      datasets:[{ data: data.top_ports.map(p=>p.count), backgroundColor: '#f59e0b' }]
    },
    options:{ plugins:{ legend:{display:false} }, scales:{ y:{beginAtZero:true} } }
  });

  new Chart(document.getElementById('topPairsChart'), {
    type:'bar',
    data:{
      labels: data.top_pairs.map(p=>p.pair),
      datasets:[{ data: data.top_pairs.map(p=>p.count), backgroundColor: '#facc15' }]
    },
    options:{ plugins:{ legend:{display:false} }, scales:{ y:{beginAtZero:true} } }
  });

  new Chart(document.getElementById('packetSizeLine'), {
    type:'line',
    data:{
      labels: data.all_packets.map((p,i)=>i+1),
      datasets:[{
        label:'Packet Length',
        data: data.all_packets.map(p=>p.length),
        borderColor:'#0078d7',
        backgroundColor:'rgba(0,120,215,0.2)',
        tension:0.3, fill:true
      }]
    },
    options:{
      plugins:{ legend:{ position:'top' } },
      scales:{ x:{ title:{display:true,text:'Packet #'} }, y:{ title:{display:true,text:'Length'} } }
    }
  });

  new Chart(document.getElementById('protocolRadar'), {
    type:'radar',
    data:{
      labels: data.protocols.map(p=>p.protocol),
      datasets:[{
        label:'Protocol Count',
        data: data.protocols.map(p=>p.count),
        borderColor:'#00bfa5',
        backgroundColor:'rgba(0,191,165,0.25)',
        pointBackgroundColor:'#00bfa5'
      }]
    },
    options:{ plugins:{ legend:{position:'top'} } }
  });

  new Chart(document.getElementById('timeScatter'), {
    type:'scatter',
    data:{ datasets:[{ label:'Packet Size vs Packet #', data:data.all_packets.map((p,i)=>({x:i+1,y:p.length})), backgroundColor:'#ec4899' }] },
    options:{
      plugins:{ legend:{position:'top'} },
      scales:{ x:{ title:{display:true,text:'Packet #'} }, y:{ title:{display:true,text:'Packet Size'} } }
    }
  });
}

fetchResults();
</script>

</body>
</html>
